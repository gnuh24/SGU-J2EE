<div *ngIf="loading" class="text-center py-8">Đang tải chi tiết chuyến xe...</div>
<div *ngIf="error" class="text-center text-red-500 py-8">{{ error }}</div>

<div *ngIf="tripDetail && !loading && !error"
  class="trip-detail bg-white rounded-xl shadow-md p-8 max-w-3xl mx-auto mt-8">
  <h2 class="text-2xl font-bold mb-6 text-orange-600">Chi tiết chuyến xe</h2>
  <div class="grid grid-cols-2 gap-6 mb-6">
    <div>
      <div class="font-semibold text-gray-700 mb-1">Tuyến xe</div>
      <div class="text-lg font-bold text-orange-600">
        {{ tripDetail.route?.departureStation?.name }}
        <span class="mx-2 text-orange-600">→</span>
        {{ tripDetail.route?.arrivalStation?.name }}
      </div>
    </div>
    <div>
      <div class="font-semibold text-gray-700 mb-1">Thời gian khởi hành</div>
      <div class="text-lg text-gray-800">
        {{ tripDetail.departureTime | date:'dd/MM/yyyy HH:mm' }}
      </div>
    </div>
    <div>
      <div class="font-semibold text-gray-700 mb-1">Quãng đường</div>
      <div class="text-lg text-gray-800">
        {{ tripDetail.route?.distance }} km
      </div>
    </div>
    <div>
      <div class="font-semibold text-gray-700 mb-1">Thời gian hành trình</div>
      <div class="text-lg text-gray-800">
        {{ (tripDetail.route?.duration / 60) | number:'1.0-0' }} giờ
      </div>
    </div>
    <div>
      <div class="font-semibold text-gray-700 mb-1">Giá vé</div>
      <div class="text-lg text-gray-800">
        {{ tripDetail.route?.price | number }} đ
      </div>
    </div>
    <div>
      <div class="font-semibold text-gray-700 mb-1">Bến đi</div>
      <div class="text-lg text-gray-800">
        {{ tripDetail.route?.departureStation?.name }}<br>
        <span class="text-sm text-gray-500">{{ tripDetail.route?.departureStation?.address }}</span>
      </div>
    </div>
    <div>
      <div class="font-semibold text-gray-700 mb-1">Bến đến</div>
      <div class="text-lg text-gray-800">
        {{ tripDetail.route?.arrivalStation?.name }}<br>
        <span class="text-sm text-gray-500">{{ tripDetail.route?.arrivalStation?.address }}</span>
      </div>
    </div>
  </div>
  <!-- Có thể bổ sung thêm các thông tin khác như loại xe, số ghế, ... nếu cần -->
</div>

<div class="container mx-auto px-4 py-8">


  <!-- Tab navigation -->
  <div class="tab-list mb-6">
    <button [class.active]="activeTab === 'seat'" (click)="activeTab = 'seat'">Chọn ghế</button>
    <button [class.active]="activeTab === 'schedule'" (click)="activeTab = 'schedule'">Lịch trình</button>
    <button [class.active]="activeTab === 'transfer'" (click)="activeTab = 'transfer'">Trung chuyển</button>
    <button [class.active]="activeTab === 'policy'" (click)="activeTab = 'policy'">Chính sách</button>
  </div>

  <!-- Tab content -->
  <div *ngIf="activeTab === 'seat'">
    <div class="flex flex-col md:flex-row gap-6">
      <!-- Cột trái: Sơ đồ ghế, form khách hàng, điều khoản -->
      <div class="flex-1 bg-white rounded-lg shadow-md p-6">
        <div>
          <h2 class="text-xl font-bold mb-2">Chọn ghế</h2>
          <a class="text-blue-600 text-sm underline cursor-pointer mb-4 inline-block">Thông tin xe</a>
          <div class="grid grid-cols-4 gap-2 mb-4">
            <div *ngFor="let seat of seats"
              [class]="'seat-box ' + (isSeatBooked(seat.number) ? 'booked' : isSeatSelected(seat.number) ? 'selected' : '')"
              (click)="seat.status !== 'BOOKED' && toggleSeat(seat.number)">
              {{ seat.number | number:'2.0' }}
            </div>
          </div>
          <!-- Chú thích -->
          <div class="flex gap-8 mb-6 mt-2 items-center">
            <div class="flex items-center gap-2">
              <svg width="28" height="28" viewBox="0 0 28 28" fill="none">
                <rect width="28" height="28" rx="6" fill="#d1eaff" stroke="#60a5fa" stroke-width="2" />
              </svg>
              <span>Còn trống</span>
            </div>
            <div class="flex items-center gap-2">
              <svg width="28" height="28" viewBox="0 0 28 28" fill="none">
                <rect width="28" height="28" rx="6" fill="#ffeaea" stroke="#ffb4b4" stroke-width="2" />
              </svg>
              <span>Đang chọn</span>
            </div>
            <div class="flex items-center gap-2">
              <svg width="28" height="28" viewBox="0 0 28 28" fill="none">
                <rect width="28" height="28" rx="6" fill="#e5e7eb" stroke="#9ca3af" stroke-width="2" />
              </svg>
              <span>Đã bán</span>
            </div>
          </div>
          <!-- Bảng thông tin ghế đã chọn và thành tiền -->
          <div class="mt-4 mb-4 p-4 bg-gray-50 rounded-lg border border-gray-200">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-2">
              <div>
                <span class="font-semibold">Số ghế đang chọn:</span>
                <span class="text-blue-600 font-bold">{{ selectedSeats.length }}</span>
                <span *ngIf="selectedSeats.length > 0"> ({{ selectedSeats.join(', ') }})</span>
              </div>
              <div>
                <span class="font-semibold">Thành tiền:</span>
                <span class="text-orange-600 font-bold text-lg">{{ totalPrice | number }} đ</span>
              </div>
            </div>
          </div>
          <!-- Nút đặt ghế -->
          <div class="flex justify-end">
            <button
              class="px-6 py-2 bg-orange-500 text-white font-bold rounded-lg shadow hover:bg-orange-600 transition disabled:opacity-50"
              [disabled]="selectedSeats.length === 0" (click)="bookSeats()">
              Đặt ghế
            </button>
          </div>
        </div>

        <!-- Điều khoản & lưu ý -->
        <div class="mt-8">
          <div class="text-center text-orange-600 font-semibold mb-2">ĐIỀU KHOẢN & LƯU Ý</div>
          <div class="text-sm text-gray-700">
            <p>(*) Quý khách vui lòng có mặt tại bến xuất phát của xe trước ít nhất 30 phút giờ xe khởi hành, mang theo
              thông báo đã thanh toán vé thành công có chứa mã vé được gửi từ hệ thống FUTA BUS LINES. Vui lòng liên hệ
              Trung tâm tổng đài <span class="text-red-500 font-bold">1900 6067</span> để được hỗ trợ.</p>
            <p class="mt-2">(*) Nếu quý khách có nhu cầu trung chuyển, vui lòng liên hệ Tổng đài trung chuyển <span
                class="text-red-500 font-bold">1900 6918</span> trước khi đặt vé. Chúng tôi không đón/trung chuyển tại
              những điểm xe trung chuyển không thể tới được.</p>
          </div>
        </div>
      </div>

    </div>
  </div>

  <div *ngIf="activeTab === 'schedule'">
    <div class="schedule-info">
      <div class="flex items-center gap-8 mb-4">
        <div>
          <span class="font-bold">12:00</span>
          <span class="ml-2">An Hữu - Tiền Giang</span>
          <div class="text-gray-500 text-sm">Ấp Thống, xã Hòa Hưng, huyện Cái Bè, tỉnh Tiền Giang</div>
        </div>
        <div>
          <span class="font-bold">14:00</span>
          <span class="ml-2">BX Miền Tây</span>
          <div class="text-gray-500 text-sm">VP BX Miền Tây: 395 Kinh Dương Vương, P.An Lạc, Q.Bình Tân, TP.HCM</div>
        </div>
      </div>
      <div class="text-gray-600 text-sm mt-4">
        <b>Lưu ý</b>: Thời gian các mốc lịch trình là thời gian dự kiến. Lịch trình này có thể thay đổi tùy vào tình
        hình thực tế xuất bến sớm hay trễ.
      </div>
    </div>
  </div>

  <div *ngIf="activeTab === 'transfer'">
    <div class="transfer-info">
      <b>Đón/ trả tận nơi:</b><br />
      - Thời gian nhận khách: <i>Trước 4 tiếng.</i><br />
      - Thời gian xe đón: <i>Chuẩn bị trước 2-3 tiếng, do mật độ giao thông trong thành phố và sẽ kết hợp đón nhiều điểm
        khác nhau nên thời gian đón cụ thể tài xế sẽ liên hệ hẹn giờ.</i><br />
      - Hẻm nhỏ xe không quay đầu được: <i>Xe trung chuyển sẽ đón Khách đầu hẻm/ đầu đường.</i><br />
      - Khu vực có biển cấm dừng đỗ xe không đón được: <i>Xe trung chuyển sẽ đón tại vị trí gần nhất có thể.</i><br />
      - Hành lý: <i>Hành lý nhỏ gọn dưới 20 kg, không vận chuyển kèm động vật, thú cưng, không mang đồ có mùi, đồ chảy
        nước trên xe.</i>
    </div>
  </div>

  <div *ngIf="activeTab === 'policy'">
    <div class="policy-info">
      <b>Chính sách huỷ vé</b>
      <ul>
        <li>Chỉ được chuyển đổi vé 1 lần duy nhất</li>
        <li>Chi phí huỷ vé từ 10% – 30% giá vé tuỳ thuộc thời gian huỷ vé so với giờ khởi hành ghi trên vé và số lượng
          vé cá nhân/tập thể áp dụng theo các quy định hiện hành.</li>
        <li>Quý khách khi có nhu cầu muốn thay đổi hoặc huỷ vé đã thanh toán, cần liên hệ với Trung tâm tổng đài 1900
          6067 hoặc quầy vé chậm nhất trước 24h so với giờ xe khởi hành được ghi trên vé, trên email hoặc tin nhắn để
          được hướng dẫn thêm.</li>
      </ul>
      <b>Yêu cầu khi lên xe</b>
      <ul>
        <li>Có mặt tại Văn phòng/Bến xe (Địa điểm xe đón trực tiếp) trước 30 phút để làm thủ tục lên xe (đối với ngày lễ
          tết cần ra trước 60 phút).</li>
        <li>Xuất trình thông tin vé được gửi qua SMS/Email/Futa App hoặc liên hệ quầy vé để nhận thông tin vé trước khi
          lên xe.</li>
        <li>Không mang thức ăn/đồ uống có mùi lên xe.</li>
        <li>Không hút thuốc, không sử dụng đồ uống có cồn hoặc sử dụng chất kích thích trên xe.</li>
        <li>Không mang các vật dễ cháy nổ lên xe.</li>
        <li>Không vứt rác trên xe.</li>
        <li>Không mang động vật lên xe.</li>
      </ul>
      <b>Hành lý xách tay</b>
      <ul>
        <li>Tổng trọng lượng hành lý không vượt quá 20kg</li>
        <li>Không vận chuyển hàng hoá cồng kềnh</li>
      </ul>
      <b>Trẻ em dưới 6 tuổi và phụ nữ có thai</b>
      <ul>
        <li>Trẻ em dưới 6 tuổi, cao từ 1.3m trở xuống, cân nặng dưới 30kg thì không phải mua vé.</li>
        <li>Trong trường hợp trẻ em không thoả 1 trong 3 tiêu chí trên sẽ mua 01 vé tương đương với người lớn.</li>
        <li>Mỗi người lớn sẽ đi kèm tối đa một trẻ em.</li>
        <li>Phụ nữ có thai cần đảm bảo sức khoẻ trong suốt quá trình di chuyển.</li>
      </ul>
      <b>Vé đón đường</b>
      <ul>
        <li>Trường hợp có nhu cầu lên xe dọc đường, Quý khách vui lòng liên hệ tổng đài 19006067 để đăng kí trước ít
          nhất 2 tiếng so với giờ xe khởi hành và vui lòng chuẩn bị hành lý nhỏ gọn (tối đa 20kg).</li>
        <li>Lưu ý, chúng tôi chỉ hỗ trợ đón ở một số địa điểm thuận tiện nằm trên lộ trình</li>
      </ul>
    </div>
  </div>
</div>

<!-- Style bổ sung cho ghế và legend -->
<style>
  .seat-box {
    @apply w-12 h-12 flex items-center justify-center rounded-lg border border-gray-300 cursor-pointer bg-gray-100 text-base font-semibold transition;
  }

  .seat-box.selected {
    @apply bg-blue-400 text-white border-blue-600;
  }

  .seat-box.booked {
    @apply bg-gray-500 text-white border-gray-700 cursor-not-allowed;
  }

  .legend-box {
    @apply w-6 h-6 rounded border border-gray-400 inline-block;
  }

  .legend-box.bg-blue-400 {
    background-color: #60a5fa;
  }

  .legend-box.bg-gray-300 {
    background-color: #d1d5db;
  }

  .legend-box.bg-gray-500 {
    background-color: #6b7280;
  }
</style>

<script>
  // Sau khi nhận được tripDetail từ API:
  const coachId = this.tripDetail?.coach?.id;
  if (coachId) {
    this.http.get < any > (`http://localhost:8080/api/seats/schedule/${coachId}`).subscribe({
      next: (res) => {
        // Xử lý danh sách ghế ở đây
        console.log('Danh sách ghế:', res.data);
      },
      error: (err) => {
        console.error('Lỗi khi lấy danh sách ghế:', err);
      }
    });
  }
</script>